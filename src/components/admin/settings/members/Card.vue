<script setup lang="ts">
import type { User } from '~/server/db/schema';

const props = defineProps<{
  member: User;
}>();

const { removeMember } = await useMembers();
const session = useAuth();

const onRemove = async () => {
  try {
    await removeMember({ id: props.member.id });
  } catch (e) {
    console.error("Error occurred while removing member", e);
  }
}
</script>

<template>
  <div class="col-span-full md:col-span-2 xl:col-span-4 bg-white rounded-2xl border border-zinc-200">
    <!-- Card content -->
    <div class="flex justify-between items-center w-full p-2">
      <div class="flex items-center space-x-2">
        <img :src="member.picture" v-if="member.picture" class="w-10 h-10 rounded-xl border border-zinc-200s" />
        <div>
          <h3 class="text-lg text-zinc-800 font-semibold">{{ member.firstName }} {{ member.lastName }}</h3>
          <div class="text-sm text-zinc-400">{{ member.email }}</div>
        </div>
      </div>
      <AbstractConfirmationBox @confirm="onRemove" title="Remove Member?" confirmLabel="Remove"
        content="Member's access will be immediately disabled. No actions performed by member will be reverted."
        v-if="session.user.value?.profile.id != member.id">
        <template #input="{ open, startAction }">
          <AbstractAsyncAction :is-loading="isRemoving">
            <template #default="{ startAction }">
              <button class="btn btn-sm border border-zinc-200 hover:border-zinc-300 flex space-x-1 items-center"
                @click="open">
                <Icon name="mdi:delete" class="w-4 h-4 text-red-500" />
                <span>Remove</span>
              </button>
            </template>
          </AbstractAsyncAction>
        </template>
      </AbstractConfirmationBox>
    </div>
  </div>
</template>
